<!DOCTYPE html>
<html lang="en">

<head>
    <!-- meta -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-164778559-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-164778559-1', { cookie_flags: 'max-age=7200;secure;samesite=none' });
</script>
<!-- end google analytics -->

<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
  })(window, document, 'script', 'dataLayer', 'GTM-MX6VS7T');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="데이터분석 및 시각화 기술을 다루고 다른 tech 개념과 기술을 설명하는 블로그입니다."/>
    <meta property="og:title" content="Data Traveler - Data Tech Blog" />
    <meta property="og:image" content="https://ifh.cc/g/wRy7wk.png" />
    <meta property="og:description" content="데이터분석 및 시각화 기술을 다루고 다른 tech 개념과 기술을 설명하는 블로그입니다."/>
    <meta name="naver-site-verification" content="9587fb2e71e511ea1c87a0881159739147ed08cc" />
    <!-- css -->
    <link rel="stylesheet" type="text/css" href="/static/css/reset.css">
    <link rel="stylesheet" href="/pygments.css">
    <link rel="shortcut icon" href="/static/img/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <!-- font -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet">
    <!-- js -->
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script type="text/javascript" src="/static/js/share.js"></script>

    <title>Anywhere</title>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MX6VS7T" height="0" width="0"
        style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <header>
    <div class="title">
        <a href="/"><h1>Data Traveler</h1></a>
        <h6>Tantum videmus quantum scimus</h6>
    </div>
    <div class="icons">
        <a href="/resume.html" target="_blank"><i class="fas fa-id-card"></i></a>
        <a href="https://github.com/98hyun" target="_blank"><i class="fab fa-github"></i></a>
        <a href="https://www.facebook.com/98hyun" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="mailto:ckdckd01@gmail.com" target="_blank"><i class="fas fa-envelope"></i></a>
        <a href="https://98hyun.github.io/rss.xml" target="_blank"><i class="fas fa-rss"></i></a>
    </div>
</header>
    <div id="content">
    
<div id="post">
    <hr>
    <h3>2022-01-31</h3>
    <p class="tag"><strong>Author:</strong> 98hyun</p>
    <p class="tag"><strong>Published:</strong> 2022-02-01</p>
    <p class="tag">
	
	    <strong>Tags:</strong> 
	    
	        <a href="/tag/%EB%A7%88%EC%BC%80%ED%8C%85.html">마케팅</a>    
	    
	        <a href="/tag/%EA%B0%9C%EB%B0%9C.html">개발</a>    
	    
	        <a href="/tag/%EB%94%A5%EB%9F%AC%EB%8B%9D.html">딥러닝</a>    
	    
	        <a href="/tag/%EA%B0%9C%EB%B0%9C%ED%99%98%EA%B2%BD.html">개발환경</a>    
	    
	
</p>
    
<p><strong>Share : 
    <span>
        <a id="kakao-link-btn" href="javascript:kakao()">
            <img width="40" height="40" 
                src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_medium.png" />
        </a>
    </span>
    <span>
        <script type="text/javascript" src="https://ssl.pstatic.net/share/js/naver_sharebutton.js"></script>
        <script type="text/javascript">
            new ShareNaver.makeButton({
                "type": "f", "title": document.querySelector('meta[property="og:title"]')["content"],
                "url": window.location.href });
        </script>
    </span>
</strong></p>

    <hr>
    <h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; 마케팅 KPI  </h3>

<p>검색광고마케터를 공부하며 배웠던 kpi를 공유한다. 계산 문제는 천천히 영어는 외워서 느낌으로.</p>
<details><summary>KPI</summary><blockquote><pre><code>

CPS = 총광고비 / 구매건수 => 하나 파는데 드는 광고비용. ( CPA, CPI, CPC 등 같은 뜻)
ROI = 광고수익 / 광고비 * 100
ROAS = 광고매출 / 광고비 * 100 ( ROAS * CPS = 객단가 )
CVR = 전환율 
CTR = 클릭수 / 노출수 * 100 
최대허용 CPC = 객단가 * 이익률 * 전환율

</code></pre></blockquote></details>

<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; django </h3>

<p>개인 프로젝트로 응급실 빈 병상을 미리 데이터베이스화하여 현재위치에 따라 가장 가까운 응급실을 알려주는 웹 어플리케이션을 django로 만드는 작업을 하던 도중 개발환경설정이 중요해서 글로 남긴다. 코드 위주로 설명을 한다. </p>
<p>django는 웹 개발 프레임워크로 모든 기능을 제공한다. 모든 기능에는 대충 프론트하는데 백 다루는데 정해진 규칙만 지키면 쉽게 다른 언어와 호환이 된다는 얘기다. 다음코드는 개발환경 세팅이다.</p>
<details><summary>code</summary><blockquote><pre><code>

0. virtualenv {venv:가상환경 이름} -> cd venv/scripts -> activate.bat -> (after change env) pip install django
1. django-admin startproject {projName} -> cd {projName}
2. (in projName forder) python manage.py runserver -> start
3. python manage.py startapp {appName} -> create urls.py and make views.py -> edit projName urls.py using 'include' -> settings.py(templates,installed_apps)

</code></pre></blockquote></details>

<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; GA </h3>

<p>GAIQ 자격증은 구글에서 공부 후 오픈북으로도 풀기 때문에 쉽게 딸 수 있다.</p>
<p><a href="https://dachata.com/class/gaiq-questions-and-explanations/" target="_blank">이 사이트</a>는 문제가 다 있고, 공부할 수 있는 좋은 사이트다. </p>
<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; DNN </h3>

<p>카테고리 임베딩 nn</p>
<p>dacon에서 잡케어 추천알고리즘 경진대회에서 상위 17%의 성적으로 아쉽게 메달권은 밖이지만, 좋은 결과를 얻었다고 생각한다. 개인적으로 부스트 알고리즘과 앙상블을 했더라면 하는 아쉬움도 있다. 사용 알고리즘은 카테고리 임베딩 NN 방법이고, 아래 코드는 kaggle에서 영감을 받았던 코드다. 이 알고리즘을 선택한 이유는 모두 카테고리 변수여서 그렇고. 경험적으로 DNN이 잘먹혔다. 실제로 알고리즘으로 인한 결과또한 private leader board에서 public leader board와의 점수차가 없었다. 안정했다는 뜻이다.</p>
<p><a href="https://www.kaggle.com/abhishek/same-old-entity-embeddings">same old entity embeddings</a>라는 제목의 카테고리 인코딩 방법은 그랜드마스터 thakur가 keras 를 통해 구현한 방법이다. </p>
<details><summary>code</summary><blockquote><pre><code>

def create_model(data, catcols):    
    inputs = []
    outputs = []
    for c in catcols:
        ## categorical columns를 하나씩 긁어와서 종류를 unique value에 담는다.
        num_unique_values = int(data[c].nunique())
        ## 만약 그 종류가 50개를 넘기면 50개로 하고, 아니면 나누기 2해서 올림으로 처리한다.
        embed_dim = int(min(np.ceil((num_unique_values)/2), 50))
        ## input의 의미는 tabular에서 열 하나하나를 넣으려는거다. 그래서 shape를 한줄 즉, 예를 들어, 첫번째 열이 35개 종류의 카테고리 열이라서 (1,) 다음 열도 (1,) 종류에 상관없이 한줄의 array가 input으로 가게 된다. 
        inp = layers.Input(shape=(1,))
        ## 0부터치기 때문에 +1 하고, 아까정한 embed_dim으로 임베딩한다. 
        out = layers.Embedding(num_unique_values + 1, embed_dim, name=c)(inp)
        ## spatialDropout1D의 의미가 헷갈렸는데 stackoverflow에서 이해한 바를 써보면 기존 dropout과 차이점은 독립적으로 어떤 input의 element를 0으로 두는 것이 아닌 한 채널 즉, 우리가 말하는 (2,2,4)에서 axis=1 (2,0,4) 로 모든 축을 0 으로 만드는 방법이라고 한다. 이게 좋은 이유는 채널들간의 독립성을 유지해주기 위함이라고 한다. 
        out = layers.SpatialDropout1D(0.3)(out)
        out = layers.Reshape(target_shape=(embed_dim, ))(out)
        inputs.append(inp)
        outputs.append(out)

    ## 그리고 여기서 합친다. 각각의 열이 4개의 종류, 50개의 종류 등 여러가지를 합친후
    x = layers.Concatenate()(outputs)
    ## batch 정규화돌리고 - 여기서 batch는 세로, layer정규화는 가가라고 기억하면 쉽다.
    ## 어렵게 말하면 batch는 특성단위 정규화, layer는 샘플단위 정규화.
    x = layers.BatchNormalization()(x)

    x = layers.Dense(300, activation="relu")(x)
    x = layers.Dropout(0.3)(x)
    x = layers.BatchNormalization()(x)

    x = layers.Dense(300, activation="relu")(x)
    x = layers.Dropout(0.3)(x)
    x = layers.BatchNormalization()(x)

    ## 그리고 softmax 뿌려주기
    y = layers.Dense(2, activation="softmax")(x)

    model = Model(inputs=inputs, outputs=y)
    return model

</code></pre></blockquote></details>

<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; image regression with fastai </h3>

<p>전기뱀장어 이미지들을 통해서 평균중량을 예측하는 문제를 제공하고 있다. 본인은 머신러닝 모델은 
"When Less is More"이 중요하다고 생각한다. 가볍게 만들면서 최대효율을 뽑는게 멋있다고 생각하기 때문이다. 이번 문제를 위해 deeplearn.org를 찾아가서 최신 기술을 눈여겨 보고 관련 대회를 찾아서 사람들의 코드를 분석하며 빌려왔다. 그리고 Swin transformer 기술을 구현하여 image regression을 하는 코드를 빌려와서 mae 3.82로 며칠 1위를 하고 있었다. ( 다시뺏겼지만 ) 그리고 아래는 fastai를 통해 구현한 플로우를 설명하고자 한다. </p>
<p>우선, 이해한 바로는 swin transformer는 object detection 관련 논문이다. 구역을 나누는 것이 중요하다. text에 사용되는 transformer와 같은 transformer 용어다. 그리고 patch를 처음 아주작게부터 시작해 크게 병합하는 과정을 계층적으로 진행한다. 그래서 작은 객체부터 큰객체까지 잘 검출할 수 있다는 것이 논문 주장이다. 그리고 patch를 경험적으로 합치고 학습을 진행할 때, window(patch를 합친)는 padding을 추가하지 않고 넘어간 경우는 다시 옆에 붙여서진행하는것 같다. (이부분이 어려워서 <a href="https://deep-learning-study.tistory.com/728#:~:text=ViT%EC%9D%98%20self%2Dattention%EC%9D%80,%EB%B9%A8%EB%9D%BC%EC%A7%84%EB%8B%A4%EB%8A%94%20%EC%9E%A5%EC%A0%90%EC%9D%B4%20%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4.">위 링크</a>를 참고할 것.) 또한 계산량의 이점이 있다고 한다. </p>
<p>아래는 fastai로 구현한 코드다. 2021년 늦게 나온 논문같은데 벌써 구현 코드가 있다. 신기하다. 구현코드는 <a href="https://colab.research.google.com/drive/1-OkbtFqrlo6hRSPJzJ0FiB4h13kkbqE1?usp=sharing">이 링크</a>를 통해 자세히 볼 수 있다.</p>
<details><summary>code</summary><blockquote><pre><code>

# fastai를 통해서 각각은 resize를 통해 224x224로, 계산의 복잡도를 낮추기 위해서
# batch transforms에는 세개의 basic transform을 적용한다.
dls = ImageDataLoaders.from_df(train_df, #pass in train DataFrame
                               path='/content/dataset',
                               valid_pct=0.2, #80-20 train-validation random split
                               seed=999, #seed
                               fn_col='path', #filename/path is in the second column of the DataFrame
                               label_col='norm_AvgWeight', #label is in the first column of the DataFrame
                               y_block=RegressionBlock, #The type of target
                               bs=8, #pass in batch size
                               num_workers=8,
                               item_tfms=Resize(224), #pass in item_tfms
                               batch_tfms=setup_aug_tfms([Dihedral(),Zoom(),Warp()])) #pass in batch_tfms

# Swin Transformer 모델을 기본으로 훈련한다. 그에 필요한 파일을 load한다. 
model = create_model('swin_large_patch4_window7_224', pretrained=True, num_classes=dls.c)

# metric은 120을 곱한 mae로 한다. 
def eel_mae(input,target):
    return 120*(F.l1_loss(F.sigmoid(input.flatten()), target))

# 분류문제로 치환한다.
# AccumMetric은 메트릭을 계산하기 위해 유효성 검사에서 모든 배치의 누적 예측값을 사용한다.
learn = Learner(dls, model, loss_func=BCEWithLogitsLossFlat(), metrics=AccumMetric(eel_mae))
</code></pre></blockquote></details>

<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; Colab Template</h3>

<p>aifactory에서 전기뱀장어 이미지를 통한 중량 예측 대회를 진행하고 있다.
이미지데이터는 항상 용량이 크기 때문에 코랩에서 기본으로 주는 용량으로 안될 때도 있고, 다운받아서 다시 올리는것도 일이되고 그렇다. </p>
<p>그런데, 만약 드라이브 링크로 데이터를 제공한다면 본인 드라이브에서 바로가기추가를 하면 드라이브에서 엑세스가 가능하다. 아래는 드라이브에서 편하게 엑세스할 수 있는 api 코드들을 제공한다. </p>
<details><summary>code</summary><blockquote><pre><code>

## 엑세스
from google.colab import drive
drive.mount('/content/drive/')

## zipfile 압축해제 
import zipfile

zip_ref = zipfile.ZipFile("/content/drive/MyDrive/colab/dataset.zip", 'r')
zip_ref.extractall("/content")
zip_ref.close()

## 번외 - 개발중 오래켜두기 위한 

function ClickConnect(){
    console.log("코랩 연결 끊김 방지");
    document.querySelector("colab-toolbar-button#connect").click()
}
setInterval(ClickConnect, 60 * 1000)

## submit 파일 접근
from google.colab import files
files.download('submission04.csv')

</code></pre></blockquote></details>

<p><br></p>
<h3 style="border-left: solid 3px #0E6073;"><span style="background-color:#2e3f59"></span> &nbsp; Flutter </h3>

<p>side project로 flutter led project를 진행했다. </p>
<p>주문에 소극적인 사람들을 위해, 그리고 연예인을 응원하고 싶은 사람들을 위해 만들었다.
친구들한테 보여줬을 때 즐거워했고 본인또한 처음만드는 어플리케이션을 처음사용하는 flutter 스택을 이용하여 개발했고, 라이브러리를 찾으며 밤낮으로 몰두하며 만들었다. 코드는 <a href="https://github.com/98hyun/side/tree/master/fapp1" target="_black">github</a>에 있다.  </p>
<iframe width="800" height="500" src="https://www.youtube.com/embed/cULrtfQt1f4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<details><summary>code</summary><blockquote><pre><code>

## open
open -a simulator

## develop
flutter create {app name}
flutter run -> press R in order to reload hot

## after connecting iphone
flutte run -d {device name} --release

</code></pre></blockquote></details>

<p><br></p>
    <div id="vcomment"></div>
</div>
<script>
    new Valine({
        el: '#vcomment',
        appId: 'pMCP910pdFNjniAUKmcPWSzx-MdYXbMMI',
        appKey: 'kywgNcY0JmhAJ5UxQ1yPMl6c',
        meta: ['nick', 'mail'],
        lang: 'en',
        pageSize: 7
    });
</script>

    </div>
    <footer>
    <h6>98hyun © 2021 Powered by Flask</h6>
</footer>
</body>

</html>